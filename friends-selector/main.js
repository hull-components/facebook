this.Hull=this.Hull||{},this.Hull.templates=this.Hull.templates||{},this.Hull.templates._default=this.Hull.templates._default||{},Hull.templates._default["friends-selector/main"]=function(t,e,n,i,a){function s(){return'\n    <small class="pull-right">\n      <a href="#" data-hull-action="selectAll">Select all</a>\n      &nbsp;|&nbsp;\n      <a href="#" data-hull-action="unselectAll">Unselect all</a>\n    </small>\n    '}function l(t,e){var i,a,s,l="";return l+='\n    <form>\n      <div class="row">\n        <div class="col-md-12">\n          ',i=n["if"].call(t,(i=t&&t.options,null==i||i===!1?i:i.caption),{hash:{},inverse:g.noop,fn:g.program(4,o,e),data:e}),(i||0===i)&&(l+=i),l+='\n          <textarea name="message" required class="form-control" rows="2" placeholder="'+v((a=n.fallback||t&&t.fallback,s={hash:{},data:e},a?a.call(t,(i=t&&t.options,null==i||i===!1?i:i.placeholder),"Type your invite message here !",s):b.call(t,"fallback",(i=t&&t.options,null==i||i===!1?i:i.placeholder),"Type your invite message here !",s)))+'">'+v((i=t&&t.options,i=null==i||i===!1?i:i.message,typeof i===m?i.apply(t):i))+"</textarea>\n          <hr/>\n        </div>\n      </div>\n      ",i=n["if"].call(t,t&&t.friendsList,{hash:{},inverse:g.noop,fn:g.program(6,r,e),data:e}),(i||0===i)&&(l+=i),l+='\n      \n      <div class="row">\n        <div class="col-md-12">\n          <input class="btn btn-primary btn-block" type="submit" name="method" value="Send Invitation" />\n        </div>\n      </div>\n    </form>\n    '}function o(){return"\n          <p>This is a text explanation of what's happening here....</p>\n          "}function r(t,e){var i,a,s,l="";return l+='\n      <div class="users-grid hidden">\n        ',a=n.grid||t&&t.grid,s={hash:{},inverse:g.noop,fn:g.program(7,d,e),data:e},i=a?a.call(t,t&&t.friendsList,t&&t.columns,s):b.call(t,"grid",t&&t.friendsList,t&&t.columns,s),(i||0===i)&&(l+=i),l+="\n      </div>\n      <hr/>\n      "}function d(t,e){var i,a,s="";return s+='\n        <div class="media" data-friend="',(a=n.id)?i=a.call(t,{hash:{},data:e}):(a=t&&t.id,i=typeof a===m?a.call(t,{hash:{},data:e}):a),s+=v(i)+'">\n          <div class="pull-right">\n            <input type="checkbox" name="friends[]" value="',(a=n.id)?i=a.call(t,{hash:{},data:e}):(a=t&&t.id,i=typeof a===m?a.call(t,{hash:{},data:e}):a),s+=v(i)+'" id="friend-selected-',(a=n.id)?i=a.call(t,{hash:{},data:e}):(a=t&&t.id,i=typeof a===m?a.call(t,{hash:{},data:e}):a),s+=v(i)+'" class="hidden"/>\n          </div>\n          <div class="pull-left">\n            <label for="friend-selected-',(a=n.id)?i=a.call(t,{hash:{},data:e}):(a=t&&t.id,i=typeof a===m?a.call(t,{hash:{},data:e}):a),s+=v(i)+'"><img src="'+v((i=t&&t.picture,i=null==i||i===!1?i:i.data,i=null==i||i===!1?i:i.url,typeof i===m?i.apply(t):i))+'" /></label>\n          </div>\n          <label for="friend-selected-',(a=n.id)?i=a.call(t,{hash:{},data:e}):(a=t&&t.id,i=typeof a===m?a.call(t,{hash:{},data:e}):a),s+=v(i)+'">\n            <div class="media-body">\n              <h5>',(a=n.name)?i=a.call(t,{hash:{},data:e}):(a=t&&t.name,i=typeof a===m?a.call(t,{hash:{},data:e}):a),s+=v(i)+"</h5>\n            </div>\n          </label>\n        </div>\n        </a>\n        "}function c(){return'\n    <button class="btn btn-primary" data-hull-action="loginWithFacebook">\n      Login with Facebook\n    </button>\n    '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,t.helpers),a=a||{};var h,f,u,p="",m="function",v=this.escapeExpression,g=this,b=n.helperMissing;return p+='<div class="panel panel-default">\n  <div class="panel-heading">\n    ',h=n["if"].call(e,e&&e.friendsList,{hash:{},inverse:g.noop,fn:g.program(1,s,a),data:a}),(h||0===h)&&(p+=h),p+='\n    <h2 class="panel-title">'+v((f=n.fallback||e&&e.fallback,u={hash:{},data:a},f?f.call(e,(h=e&&e.options,null==h||h===!1?h:h.title),"Select friends",u):b.call(e,"fallback",(h=e&&e.options,null==h||h===!1?h:h.title),"Select friends",u)))+'</h2>\n  </div>\n\n  <div class="panel-body">\n    ',h=n["if"].call(e,(h=e&&e.loggedIn,null==h||h===!1?h:h.facebook),{hash:{},inverse:g.program(9,c,a),fn:g.program(3,l,a),data:a}),(h||0===h)&&(p+=h),p+="\n  </div>\n\n</div>"},Hull.component({templates:["main"],refreshEvents:["model.hull.me.change"],datasources:{friends:function(){return this.loggedIn()?this.api({provider:"facebook",path:"me/friends"},{fields:this.friendsFields(),limit:1e3}):void 0}},initialize:function(){this.method=(this.options.method||"apprequests").toLowerCase(),this.buildParams=this.buildParamsFor[this.method]||function(t){return t}},events:{"submit form":function(t){t.preventDefault();var e=this,n=this.sandbox.dom.getFormData(this.$(t.target)),i=this.buildParams(n);this.api({provider:"facebook",path:"ui."+this.method},i).then(function(){e.afterSent.call(e)})},'change input[type="checkbox"]':function(t){if(t.target&&"checkbox"===t.target.type){var e=this.$("[data-friend='"+$(t.target).val()+"']");t.target.checked?e.addClass("bg-info"):e.removeClass("bg-info");var n,i=this.$('input[type="checkbox"]:checked').length;n=i>0?"Send to "+this.$('input[type="checkbox"]:checked').length+" friends":"Send",this.$sendBtn.val(n)}}},actions:{selectAll:function(){this.$('input[type="checkbox"]').each(function(t,e){e.checked||$(e).click()})},unselectAll:function(){this.$('input[type="checkbox"]').each(function(t,e){e.checked&&$(e).click()})},loginWithFacebook:function(t,e){var n=this,i="login";this.loggedIn()&&(i="linkIdentity");var a=this.sandbox[this.loginAction||i];e.el.text("Loading...");var s={};this.options.permissions&&(s.scope=this.options.permissions),a("facebook",s).then(function(t){e.el.text("Logged in with "+t.name)},function(t){"identity_taken"==t.reason&&(n.loginAction="login",e.el.text("Login with Facebook"))})}},buildParamsFor:{share:function(t){return t.href=t.href||this.options.href||document.location.toString(),t.friends&&t.friends.length>0&&(t.to=t.friends.join(","),delete t.friends),t},apprequests:function(t){return t.friends&&t.friends.length>0&&(t.to=t.friends.join(","),delete t.friends),this.options.redirectTo&&(t.data=JSON.stringify({r:this.options.redirectTo})),this.options.title&&(t.title=this.options.title||"Invite your friends"),t}},helpers:{grid:function(t,e,n){for(var i="<div class='row'>",a="</div>",s=i,l="col-md-"+12/e,o=0,r=t.length;r>o;o++)s+="<div class='"+l+"'>"+n.fn(t[o])+"</div>",o>0&&(o+1)%e==0&&(s+=a,r>o+1&&(s+=i));return t.length%e!=0&&(s+=a),s}},beforeRender:function(t){t.friendsList=[],t.friends&&(t.friendsList=this.filterFriends(t.friends.data||[])),t.columns=this.options.columns||2},afterRender:function(){var t=this.$(".users-grid");t.css({overflowY:"auto",overflowX:"hidden",maxHeight:"300px"}),t.removeClass("hidden"),this.$sendBtn=this.$('input[type="submit"]'),this.$('textarea[name="message"]').focus()},afterSent:function(){var t=this.$sendBtn;this.actions.unselectAll.call(this),t.val("Sent !"),t.attr("disabled",!0),setTimeout(function(){t.val("Send"),t.attr("disabled",!1)},1e3)},friendsFields:function(){var t=this.sandbox.util._,e=(this.options.friendsFields||"").split(",")||[],n=this.friendsFilters();return t.each(n,function(n){t.isObject(n)&&(e=e.concat(t.keys(n)))}),e=e.concat(["id","name","picture"]),t.compact(t.uniq(e))},friendsFilters:function(){var t,e=this.sandbox.util._;return t=e.isArray(this.options.friendsFilters)?this.options.friendsFilters:e.compact([this.options.friendsFilters])},filterFriends:function(t){var e,n=this.sandbox.util._,i=this.friendsFilters();return e=0==i.length?t:n.filter(t,function(t){var e=[];return n.each(i,function(i){if(n.isObject(i)){var a=n.keys(i);e.push(n.isEqual(n.pick(t,a),i))}}),n.any(e)}),n.sortBy(e,function(t){return t.name})}});